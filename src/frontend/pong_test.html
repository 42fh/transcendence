<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pong Game</title>
    <style>
        #game-container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
        }
        #game {
            width: 100%;
            height: 80vh;
            position: relative;
            background-color: #000;
        }
        .paddle {
            position: absolute;
            background-color: #fff;
        }
        #ball {
            position: absolute;
            background-color: #fff;
            border-radius: 50%;
        }
        #score-display {
            display: flex;
            justify-content: space-between;
            font-size: 24px;
            margin-bottom: 10px;
        }
        .score {
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div>
            <label for="player-id">Choose Player ID:</label>
            <input type="text" id="player-id">
            <label for="game-id">Enter Game ID:</label>
            <input type="text" id="game-id">
            <button onclick="startGame()">Start Game</button>
        </div>

        <div id="score-display">
            <div id="left-score" class="score">Left: 0</div>
            <div id="right-score" class="score">Right: 0</div>
        </div>

        <div id="game"></div>

        <div>
            <button onmousedown="movePaddle('up')" onmouseup="stopPaddle()">Move Paddle Up</button>
            <button onmousedown="movePaddle('down')" onmouseup="stopPaddle()">Move Paddle Down</button>
        </div>
    </div>

    <script>
        let socket;
        let playerId;
        let gameId;
        let gameState;
        let paddle;

        function startGame() {
            playerId = document.getElementById('player-id').value;
            gameId = document.getElementById('game-id').value;
            socket = new WebSocket(`ws://localhost:8000/ws/game/${gameId}/?player=${playerId}`);

            socket.onmessage = function(e) {
                const data = JSON.parse(e.data);
		console.log(data);
		 if (data.game_state){                                                                                                                                                   
                    gameState = data.game_state;
                    updateGameDisplay();
                }
            };

            socket.onopen = function(e) {
                console.log("Connected to WebSocket");
            };
        }

        function updateGameDisplay() {
            const gameDiv = document.getElementById('game');
            const gameWidth = gameDiv.clientWidth;
            const gameHeight = gameDiv.clientHeight;

            // Update paddles
            updatePaddle('left', gameState.paddle_left.y, gameWidth, gameHeight);
            updatePaddle('right', gameState.paddle_right.y, gameWidth, gameHeight);

            // Update ball
            updateBall(gameState.ball, gameWidth, gameHeight);

            // Update score
            updateScore(gameState.score);
        }

        function updatePaddle(side, y, gameWidth, gameHeight) {
            const paddleHeight = gameState.dimensions.paddle_height * gameHeight;
            const paddleWidth = gameState.dimensions.paddle_width * gameWidth;
            const paddleY = y * gameHeight;

            let paddleElement = document.getElementById(`paddle-${side}`);
            if (!paddleElement) {
                paddleElement = document.createElement('div');
                paddleElement.id = `paddle-${side}`;
                paddleElement.className = 'paddle';
                document.getElementById('game').appendChild(paddleElement);
            }

            paddleElement.style.width = `${paddleWidth}px`;
            paddleElement.style.height = `${paddleHeight}px`;
            paddleElement.style.top = `${paddleY}px`;
            paddleElement.style.left = side === 'left' ? '0' : `${gameWidth - paddleWidth}px`;
        }

        function updateBall(ball, gameWidth, gameHeight) {
            const ballSize = ball.size * gameWidth; // Assuming square ball
            const ballX = ball.x * gameWidth;
            const ballY = ball.y * gameHeight;

            let ballElement = document.getElementById('ball');
            if (!ballElement) {
                ballElement = document.createElement('div');
                ballElement.id = 'ball';
                document.getElementById('game').appendChild(ballElement);
            }

            ballElement.style.width = `${ballSize}px`;
            ballElement.style.height = `${ballSize}px`;
            ballElement.style.left = `${ballX}px`;
            ballElement.style.top = `${ballY}px`;
        }

        function updateScore(score) {
            document.getElementById('left-score').textContent = `Left: ${score.left}`;
            document.getElementById('right-score').textContent = `Right: ${score.right}`;
        }

        function movePaddle(direction) {
            socket.send(JSON.stringify({
                action: 'move_paddle',
                direction: direction,
                user_id: playerId
            }));
        }

        function stopPaddle() {
            // You might want to implement paddle stopping logic here
        }
    </script>
</body>
</html>

