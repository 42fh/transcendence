<!DOCTYPE html>
<html>
<head>
    <title>Pong Game WebSocket Test</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        #paddle {
            width: 25px;
            height: 150px;
            background-color: red;
            position: absolute;
            left: 0px;
            transform: translateY(-50%);
        }
    </style>
</head>
<body>
    <h1>WebSocket Pong Game Test</h1>
    <div id="paddle"></div>

    <script>
        const clientID = new URLSearchParams(window.location.search).get('client');
        console.log('Client ID:', clientID);

        const socket = new WebSocket('ws://' + window.location.host + '/ws/game/');

        const paddle = document.getElementById('paddle');
        let paddlePosition = { top: paddle.offsetTop, left: paddle.offsetLeft };

        socket.onmessage = function(event) {
            const data = JSON.parse(event.data);
            if (data.type === 'position') {
                updatePaddlePosition(data.position);
            } else {
                console.log('Received:', data);
            }
        };

        document.addEventListener('keydown', function(event) {
            if (event.key === 'ArrowUp' && paddlePosition.top > 0) {
                paddlePosition.top -= 10;
            } else if (event.key === 'ArrowDown' && paddlePosition.top < window.innerHeight - paddle.offsetHeight) {
                paddlePosition.top += 10;
            }
            updatePaddlePosition(paddlePosition);
            socket.send(JSON.stringify({'type': 'position', 'clientID': clientID, 'position': paddlePosition}));
        });

        function updatePaddlePosition(position) {
            paddle.style.top = position.top + 'px';
            paddle.style.left = position.left + 'px';
            paddlePosition = position; // Update the local position to the received position
        }

        // Send the initial position to the server when the connection is established
        socket.onopen = function() {
            socket.send(JSON.stringify({'type': 'position', 'clientID': clientID, 'position': paddlePosition}));
        };
    </script>
</body>
</html>
