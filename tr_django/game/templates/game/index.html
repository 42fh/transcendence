<!DOCTYPE html>
<html>
<head>
    <title>Pong Game WebSocket Test</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        #gameField {
            width: 50vw; /* 50% of the viewport */
            height: 500px;
            background-color: #000;
            position: relative;
        }
        /* Class selector for paddles */
        .paddle {
            width: 2%;
            height: 100px;
            background-color: red;
            position: absolute;
        }
        /* ID selector */
        #paddle1 {
            left: 2%;
        }
        #paddle2 {
            left: 96%;
        }
    </style>
</head>
<body>
    <h1>WebSocket Pong Game Test</h1>
    <div id="gameField">
        <div id="paddle1" class="paddle"></div>
        <div id="paddle2" class="paddle"></div>
    </div>

    <script>
        const clientID = new URLSearchParams(window.location.search).get('client');
        console.log('Client ID:', clientID);

        const socket = new WebSocket('ws://' + window.location.host + '/ws/game/');

        // Retrieves element in HTML and assign constant
        const paddle1 = document.getElementById('paddle1');
        const paddle2 = document.getElementById('paddle2');

        //left refers to the distance from the left of the viewport to the left of the specified element
        let paddlePosition = {
            top: (window.innerHeight / 2) - (paddle1.offsetHeight / 2), // Initialize position
            left: (clientID === '1') ? paddle1.offsetLeft : paddle2.offsetLeft
        };

        // Receive messages from the server
        socket.onmessage = function(event) {
            const data = JSON.parse(event.data);
            if (data.type === 'position') {
                if (data.clientID === '1') {
                    updatePaddlePosition(paddle1, data.position);
                } else if (data.clientID === '2') {
                    updatePaddlePosition(paddle2, data.position);
                }
            } else {
                console.log('Unexpected, received:', data);
            }
        };

        // Send
        document.addEventListener('keydown', function(event) {
            if (event.key === 'ArrowUp') {
                paddlePosition.top -= 10;
            } else if (event.key === 'ArrowDown') {
                paddlePosition.top += 10;
            }
            //updatePaddlePosition is done only when receiving a message from the server
            socket.send(JSON.stringify({'type': 'position', 'clientID': clientID, 'position': paddlePosition}));
        });

        // Update HTML with new position
        function updatePaddlePosition(paddle, position) {
            paddle.style.top = position.top + 'px';
            paddle.style.left = position.left + 'px';
            console.log(`Updated ${paddle.id} position to:`, position);
        }

        socket.onopen = function() {
            socket.send(JSON.stringify({'type': 'position', 'clientID': clientID, 'position': paddlePosition}));
        };

        // Initialize paddle positions based on the client ID
        if (clientID === '1') {
            updatePaddlePosition(paddle1, paddlePosition);
        } else if (clientID === '2') {
            updatePaddlePosition(paddle2, paddlePosition);
        }
    </script>
</body>
</html>
